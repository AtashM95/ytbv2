# WF-01 — Orchestrator

## Purpose
Pipeline-ı koordinasiya edir, run registry yazır, WF-03…WF-09 ardıcıllığını idarə edir və keyfiyyət gate-lərini tətbiq edir.

## Inputs
- `environment`, `scope`, `channel_key`
- `mode`, `video_type`, `selected_topic`, `keywords`, `quality` və s.
- WF-10 Get Config output

## Outputs
- Run Contract (yeni `run_id` ilə)
- Final manifest + status (`COMPLETED`, `FAILED_*`, `TEST_COMPLETED`)

## Nodes plan
1. **Trigger: Webhook** — giriş payload qəbul edilir.
2. **Init Pipeline** — `run_id`, manifest və registry insert.
3. **WF-10 Get Config** — config resolve.
4. **Policy Gate** — forbidden_keywords check.
5. **Uniqueness Gate** — template/style təkrarı yoxlanır.
6. **WF-03…WF-09** — script, review, voiceover, assets, render, thumbnail, publish.
7. **Run Registry Update** — hər major step sonrası status update.
8. **Build Response** — final output qaytarılır.

## Error handling
- Config/Storage fail → `FAILED_CONFIG*`
- Policy gate fail → `FAILED_POLICY`
- Uniqueness gate fail → `FAILED_UNIQUENESS`
- YouTube auth/quota fail → `FAILED_YT_AUTH` / `FAILED_YT_QUOTA`

## Test cases
1. Valid input ilə run yaradılır və registry `RUNNING` yazılır.
2. Policy gate pozularsa `FAILED_POLICY` qaytarılır və registry update olunur.
3. Uniqueness gate pozularsa `FAILED_UNIQUENESS` qaytarılır.
4. Publish uğurlu olduqda registry `SUCCESS` olur.
