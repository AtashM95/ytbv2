# WF-02 — Research & Source Intake

## Purpose
İdeya üçün mənbələr toplanır, script yazımı üçün research dataları manifest-ə əlavə edilir.

## Inputs
- Run Contract (`run_id`, `manifest`)
- Research sources list (URL, title, license)
- WF-10 Get Config output

## Outputs
- Run Contract yenilənmiş `manifest.content.sources`
- Manifest `status.phase = research`

## Nodes plan
1. **Trigger: Manual/UI or API** — research mənbələri daxil edilir.
2. **Node: Get Config (WF-10)** — config alınır.
3. **Node: Validate Sources** — URL formatı, license mövcudluğu.
4. **Node: Enrich Metadata** — domen və source tipi əlavəsi.
5. **Node: Update Manifest** — `content.sources` list yenilənir.
6. **Node: Persist Run Update** — run yenilənir.
7. **Node: Emit Event** — WF-03 üçün event.

## Error handling
- Source URL invalid → `invalid_source_url`.
- License missing → `license_required`.
- Persist fail → retry (3 dəfə), sonra `update_failed`.

## Test cases
1. Bir neçə mənbə əlavə edilir, `manifest.content.sources` yenilənir.
2. URL səhv formatda olduqda error qaytarılır.
3. License boş olduqda error qaytarılır.
4. DB write fail simulyasiyası retry sayını təsdiqləyir.
