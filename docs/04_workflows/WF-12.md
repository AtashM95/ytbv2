# WF-12 — Short Extractor

## Purpose
Mövcud uzun YouTube video-dan qısa (60 saniyəlik) viral segments çıxarmaq üçün AI-powered analiz workflow-u.

## Inputs
- `run_id` — unique run identifier
- `mode` — "test" | "auto_trend" | "manual"
- `source_video_url` — YouTube URL (e.g., `https://youtube.com/watch?v=VIDEO_ID`)

## Outputs
- `source_video` — original video metadata
- `extraction_jobs` — array of segment extraction tasks
- `total_shorts_to_create` — number of shorts identified
- `status` — "EXTRACTION_READY" | "NO_EXTRACTION_POSSIBLE" | "FAILED"

## Nodes plan
1. **Trigger: Webhook** — POST `/webhook/wf-12-short-extractor`
2. **Node: Validate Source URL** — YouTube URL regex validation, video ID extraction
3. **Node: Get Video Info** — YouTube Data API v3 call for video metadata
4. **Node: Parse Video Info** — Extract title, description, duration, tags
5. **Node: AI Segment Analysis** — OpenAI GPT-4o-mini call for viral moment detection
6. **Node: Process Segments** — Validate timestamps, build extraction jobs
7. **Node: Save Extraction Results** — PostgreSQL insert to `yt_studio_shorts_extraction`
8. **Node: Build Response** — Return extraction jobs for orchestrator

## AI Segment Analysis Prompt
```
Analyze this video and suggest N viral-worthy segments for YouTube Shorts (max 60 seconds each):

Title: {title}
Duration: {duration_seconds} seconds
Description: {description}
Tags: {tags}

Respond in JSON format:
{
  "segments": [
    {
      "start_time": number (seconds),
      "end_time": number (seconds),
      "duration": number (seconds),
      "hook": "attention-grabbing title for this segment",
      "viral_score": 1-100,
      "reasoning": "why this segment would work as a Short"
    }
  ]
}

Focus on: hooks, surprising moments, valuable tips, emotional peaks, or cliffhangers.
```

## Test Mode Behavior
- `num_shorts: 1` (production: 3)
- `target_duration: 30` seconds (production: 60)

## Output Structure
```json
{
  "extraction_jobs": [
    {
      "segment_id": "seg_1",
      "source_url": "https://youtube.com/watch?v=VIDEO_ID",
      "start_time": 120,
      "end_time": 175,
      "duration": 55,
      "suggested_title": "The Shocking Truth About...",
      "viral_score": 85,
      "create_request": {
        "mode": "auto_trend",
        "video_type": "short",
        "custom_topic": "...",
        "source_segment": {...}
      }
    }
  ]
}
```

## Integration with WF-00
When `video_type: "short_from_long"` is passed to Main Router:
1. WF-00 routes to WF-12
2. WF-12 returns extraction jobs
3. Each job can be passed to WF-01 Orchestrator to create individual shorts

## Error Handling
- Invalid YouTube URL → `FAILED` with validation error
- Video not found → `FAILED` with "Video not found or not accessible"
- AI analysis failed → Fallback to default segments (first N segments of video)
