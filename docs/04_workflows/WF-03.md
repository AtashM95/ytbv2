# WF-03 — Script Draft

## Purpose
Research məlumatları əsasında ssenari hazırlanır və manifest-ə yazılır.

## Inputs
- Run Contract (`run_id`, `manifest.content`, `manifest.production`)
- Script generation prompt və outline
- WF-10 Get Config output

## Outputs
- Run Contract yenilənmiş `manifest.content.script`
- Manifest `status.phase = script_draft`

## Nodes plan
1. **Trigger: Manual or Scheduled** — script generation başlanır.
2. **Node: Get Config (WF-10)** — config alınır.
3. **Node: Build Prompt** — topic, sources, keywords ilə prompt.
4. **Node: Generate Script** — LLM/Tətbiq ilə script yaradılır.
5. **Node: Validate Script Length** — minimum/maximum söz sayı.
6. **Node: Update Manifest** — `content.script` yazılır.
7. **Node: Persist Run Update** — run yenilənir.
8. **Node: Emit Event** — WF-04 üçün event.

## Error handling
- Script generation fail → retry (2 dəfə), sonra `script_generation_failed`.
- Script length out of range → `script_length_invalid`.
- Persist fail → retry (3 dəfə), sonra `update_failed`.

## Test cases
1. Script yaradılır və `manifest.content.script` dolur.
2. Script çox qısa olduqda validation error qaytarılır.
3. Generation fail simulyasiyası retry siyasətini yoxlayır.
4. Persist fail simulyasiyası error statusunu verir.
