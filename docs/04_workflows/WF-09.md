# WF-09 — YouTube Publisher

## Purpose
Video-nu YouTube-a yükləmək və metadata set etmək üçün publisher workflow-u.

## Inputs
- `run_id` — unique run identifier
- `mode` — "test" | "auto_trend" | "manual"
- `render_url` — fallback chain: `input.render_url` || `manifest.render.render_url` || `manifest.render_url`
- `thumbnail_url` — fallback chain: `input.thumbnail_url` || `manifest.thumbnail.url` || `manifest.thumbnail_url`
- `manifest.publish` — title, description, tags, category_id
- `options.best_time_publish` — schedule for optimal time

## Outputs
- `youtube_video_id` — uploaded video ID
- `youtube_url` — full YouTube URL
- `privacy_status` — "private" | "public" | "unlisted"
- `thumbnail_set` — boolean indicating if thumbnail was uploaded
- `status` — "PUBLISHED" | "TEST_COMPLETE" | "FAILED"

## Nodes plan
1. **Trigger: Webhook** — POST `/webhook/wf-09-publish`
2. **Node: Prepare Upload Metadata** — FIXED: render_url fallback chain istifadə edir
3. **Node: Is Test Mode?** — test modunda actual upload skip edilir
4. **Node: Download Rendered Video** — render URL-dən video binary endirmir
5. **Node: Upload to YouTube** — YouTube node ilə upload
6. **Node: Process Upload Result** — video ID çıxarılır
7. **Node: Should Upload Thumbnail?** — has_thumbnail && !error check
8. **Node: Download Thumbnail** — thumbnail URL-dən image endirilir
9. **Node: Set Thumbnail via API** — YouTube thumbnails.set API call
10. **Node: Final Response** — uğurlu/uğursuz cavab

## Test Mode Behavior
- `is_test: true` olduqda actual YouTube upload skip olunur
- Bunun əvəzinə `TEST_COMPLETE` status ilə simulated cavab qaytarılır
- Test result-da `would_upload: true` və metadata preview olur

## Thumbnail Upload
- DALL-E-dən gələn thumbnail URL-i endirilib YouTube API-ya yüklənir
- YouTube thumbnails.set endpoint: `POST /upload/youtube/v3/thumbnails/set`
- OAuth2 credential: `YouTube OAuth2`

## Error Handling
- Upload failed → `FAILED` status, error_message saxlanır
- Thumbnail set failed → `thumbnail_set: false`, video hələ də published sayılır
- Network timeout → retry 2 times with 5s backoff

## Key Fixes in v2
1. **render_url fallback chain** — `input.render_url || manifest.render.render_url || manifest.render_url`
2. **thumbnail_url fallback chain** — `input.thumbnail_url || manifest.thumbnail.url || manifest.thumbnail_url`
3. **Proper thumbnail upload** — Download + YouTube API upload əvəzinə boş update field
