# WF-09 — YouTube Publisher

## Purpose
Video-nu YouTube-a yükləmək və metadata set etmək üçün publisher workflow-u.

## Inputs
- `run_id` — unique run identifier
- `mode` — "test" | "auto_trend" | "manual"
- `render_url` — fallback chain: `input.render_url` || `manifest.render.render_url` || `manifest.render_url`
- `thumbnail_url` — fallback chain: `input.thumbnail_url` || `manifest.thumbnail.url` || `manifest.thumbnail_url`
- `manifest.publish` — title, description, tags, category_id
- `options.best_time_publish` — schedule for optimal time
- `resolved_config.youtube.credential_ref` — OAuth2 credential referansı

## Outputs
- `youtube_video_id` — uploaded video ID
- `youtube_url` — full YouTube URL
- `privacy_status` — "private" | "public" | "unlisted"
- `thumbnail_set` — boolean indicating if thumbnail was uploaded
- `status` — "PUBLISHED" | "TEST_COMPLETE" | "FAILED_YT_AUTH" | "FAILED_YT_QUOTA" | "FAILED"

## Nodes plan
1. **Trigger: Webhook** — POST `/webhook/wf-09-publish`
2. **Prepare Upload Metadata** — render_url fallback chain istifadə edir
3. **Init Upload Retry** — retry state başlat
4. **Is Test Mode?** — test modunda actual upload skip edilir
5. **Download Rendered Video** — render URL-dən video binary endirilir
6. **Upload to YouTube** — YouTube node ilə upload
7. **Classify Upload Result** — auth/quota/transient error classification
8. **Retry Loop** — exponential backoff ilə retry
9. **Thumbnail Upload** — download + API set
10. **Final Response** — uğurlu/uğursuz cavab

## OAuth/Quota Handling
- Auth/refresh token error → retry + `FAILED_YT_AUTH`
- Rate-limit/quota error → retry + `FAILED_YT_QUOTA`
- Transient error → exponential backoff retry

## Manifest Update
- Upload sonrası `manifest.publish.upload_response` sahəsinə özet yazılır.
- `youtube_video_id` və `thumbnail_set` manifest-də saxlanılır.

## Test Mode Behavior
- `is_test: true` olduqda actual YouTube upload skip olunur
- `TEST_COMPLETE` status ilə simulated cavab qaytarılır

## Error Handling
- Upload failed → `FAILED_*` status, error_message saxlanır
- Thumbnail set failed → `thumbnail_set: false`, video hələ də published sayılır
