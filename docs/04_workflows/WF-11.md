# WF-11 — Settings Panel

## Purpose
Konfiqurasiyaların və user preferences-ların idarəsi üçün form-based admin panel workflow-u.

## Inputs
- Form trigger (n8n Form Trigger node)
- User inputs via HTML form fields

## Form Fields
| Field | Type | Required | Options |
|-------|------|----------|---------|
| Environment | Dropdown | Yes | production, test |
| Scope | Dropdown | Yes | global, channel |
| Channel Category | Dropdown | Yes | Tech & AI, Finance, Health, Education, Gaming, Cooking, Travel, Real Estate, Reviews, Pets, Custom |
| Primary Language | Dropdown | Yes | en, ar, tr, es, fr, de, pt, hi |
| Target Countries | Text | No | Comma-separated ISO codes (e.g., "US, UK, CA") |
| Default Video Length | Dropdown | Yes | Short (3-5 min), Medium (8-12 min), Long (15-20 min), Extra Long (25-40 min) |
| Video Quality | Dropdown | Yes | 720p HD, 1080p Full HD, 4K Ultra HD |
| Voice Quality | Dropdown | Yes | Standard, Premium |
| Male Voice ID | Text | No | ElevenLabs voice ID |
| Female Voice ID | Text | No | ElevenLabs voice ID |
| Auto-generate Thumbnails | Dropdown | Yes | Yes, No |
| SEO Optimization | Dropdown | Yes | Enabled, Disabled |
| Auto Tags | Dropdown | Yes | Enabled, Disabled |
| OpenAI Model | Dropdown | Yes | gpt-4o-mini, gpt-4o, gpt-4-turbo |
| OpenAI Temperature | Number | No | 0.0 - 1.0 |
| Storage Provider | Dropdown | Yes | cloudinary, generic_http, s3 |
| Storage Base URL (Optional) | Text | No | CDN base URL |
| Cloudinary Cloud Name | Text | No | cloud_name |
| Cloudinary Upload Preset (Unsigned) | Text | No | upload_preset |
| Generic Upload Endpoint | Text | No | https://my-uploader/upload |

## Outputs
- PostgreSQL upsert to `yt_studio_config` table (`key`, `value`, `value_type`, `scope`, `environment`)
- Success/failure message to user
- Secrets DB-də saxlanmır (API key/secret yalnız env və ya credentials)

## Nodes plan
1. **Trigger: Form** — n8n FormTrigger node ilə web form render
2. **Node: Parse Form Data** — form field-lərini internal config format-ına çevirmək
3. **Node: Prepare Config Rows** — dot-path `key/value` formatında rows yaratmaq
4. **Node: Save Config to Database** — PostgreSQL upsert (`key`, `scope`, `environment` conflict target)
5. **Node: Build Response** — success/failure message

## Database Schema
```sql
INSERT INTO yt_studio_config (key, value, value_type, scope, environment, updated_by, is_active)
VALUES ('storage.cloudinary.cloud_name', 'demo', 'string', 'global', 'production', 'wf-11', true)
ON CONFLICT (key, scope, environment) DO UPDATE
SET value = EXCLUDED.value,
    value_type = EXCLUDED.value_type,
    credential_ref = EXCLUDED.credential_ref,
    updated_by = EXCLUDED.updated_by,
    is_active = EXCLUDED.is_active;
```

## Mapping Logic
- Form labels → internal config keys (dot-path):
  - "Tech & AI" → `category`
  - "English (en)" → `language`
  - "Short (3-5 min)" → `video_length.normal`
  - "1080p Full HD" → `quality.video`

## Error Handling
- DB connection failed → error message to user
- Invalid form data → validation error
- Successful save → "Settings saved successfully!"
