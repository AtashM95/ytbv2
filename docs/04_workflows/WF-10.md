# WF-10 — Get Config

## Purpose
Config DB/Data Table-dan konfiqurasiyanı oxuyur, resolve edir və bütün workflow-lara eyni formatda verir.

## Inputs
- `environment` parametri (`test`, `production`)
- (Opsional) `scope` (`global` default)
- (Opsional) `channel_key` (scope=`channel` olduqda tələb olunur)
- (Opsional) `mode`, `runtime_overrides`

## Outputs
- Vahid config output (`environment`, `scope`, `channel_key`, `resolved_config`, `resolved_at`, `schema_version`)
- `storage_validation` (`status`, `provider`, `missing_fields`, `reason`)
- `status` (`OK` | `FAILED_CONFIG_STORAGE`)

## Nodes plan
1. **Trigger: HTTP Request or Internal Call** — config sorğusu.
2. **Node: Normalize Input** — environment/scope/channel_key validasiyası.
3. **Node: Load Defaults** — sistem default-ları.
4. **Node: Query Config DB** — `yt_studio_config` entries (`environment` + `is_active=true`).
5. **Node: Merge DB Config** — əvvəl global, sonra channel scope override.
- (Opsional) `mode` (`test`/`production`), `runtime_overrides`

## Outputs
- Vahid config output (`environment`, `resolved_config`, `resolved_at`, `schema_version`)
- `storage_validation` (provider, is_valid, errors)
- `status` (`CONFIG_RESOLVED` və ya `FAILED_CONFIG_STORAGE`)
- Input metadata (`run_id`, `mode`, `scope`, `channel_id`, `video_type`, `category`, `language`, `quality` və s.)

## Nodes plan
1. **Trigger: HTTP Request or Internal Call** — config sorğusu.
2. **Node: Normalize Input** — environment validate, scope/mode normalize.
3. **Node: Load Defaults** — sistem default-ları.
4. **Node: Query Config DB** — `yt_studio_config` entries (`environment` + `is_active=true`).
5. **Node: Merge DB Config** — dot-path key-ləri nested strukturda birləşdirir.
6. **Node: Apply Overrides & Compute** — runtime overrides + computed fields.
7. **Node: Build Response** — storage validation və standart JSON cavab.

## Error handling
- Invalid environment → `INVALID_ENVIRONMENT` statusu.
- Invalid scope/channel_key → `INVALID_SCOPE` / `INVALID_CHANNEL_KEY`.
- Config DB unreachable → defaults ilə davam edir (`config_from_db=false`).
- Storage config invalid (production) → `FAILED_CONFIG_STORAGE`.

## Test cases
1. `production` üçün config qaytarılır və `schema_version` mövcuddur.
2. Storage config əskikdirsə `FAILED_CONFIG_STORAGE` qaytarılır.
3. Test modda storage config əskikdirsə warning ilə davam edir.
